


    Sheets.Add Before:=ActiveSheet
    ActiveSheet.Select
    ActiveSheet.Name = "Summary"

     

    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
    "DATA!$A:$DE", Version:= _
        xlPivotTableVersion15).CreatePivotTable TableDestination:="Summary!R3C1", _
        TableName:="PivotTable1", DefaultVersion:=xlPivotTableVersion15
        

    Set Pt1 = ActiveSheet.PivotTables("PivotTable1")
    
    Set PF1 = Pt1.PivotFields("TotalRevenue")
    Pt1.AddDataField PF1, "Total Revenue", xlSum

    Set PF3 = Pt1.PivotFields("TotalRevenue31MarCurr")
    Pt1.AddDataField PF3, "Total Revenue 31 Mar Rates", xlSum
    
    Set PF2 = Pt1.PivotFields("TotalBilledMonths")
    Pt1.AddDataField PF2, "Total BilledMonths", xlSum
    
    

    
    With ActiveSheet.PivotTables("PivotTable1").DataPivotField
        .Orientation = xlRowField
        .Position = 1
    End With
    
    
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("YearMonth")
        .Orientation = xlColumnField
        .Position = 1
    End With
    
    
    ActiveSheet.PivotTables("PivotTable1").CalculatedFields.Add "PM", _
        "=IF(TotalRevenue=0,0,(ProjectMargin/TotalRevenue))", True
    ActiveSheet.PivotTables("PivotTable1").PivotFields("PM").Orientation = _
        xlDataField
        

    ActiveSheet.PivotTables("PivotTable1").CalculatedFields.Add "GM", _
        "= IF(TotalRevenue=0,0,(GrossMargin/TotalRevenue))", True
    ActiveSheet.PivotTables("PivotTable1").PivotFields("GM").Orientation = _
        xlDataField
        
        

    ActiveSheet.PivotTables("PivotTable1").CalculatedFields.Add "PBT", _
        "= IF(TotalRevenue=0,0,(PBTBeforeInvestment/TotalRevenue) )", True
    ActiveSheet.PivotTables("PivotTable1").PivotFields("PBT").Orientation = _
        xlDataField
        
        
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("YearMonth")
        .PivotItems("(blank)").Visible = False
        End With

    With ActiveSheet.PivotTables("PivotTable1")
        .ColumnGrand = False
        .RowGrand = False
    End With

    Range("B13:M13").Select
    Selection.Style = "Percent"
    Range("B14:M14").Select
    Selection.Style = "Percent"
    Range("B15:M15").Select
    Selection.Style = "Percent"
    
    ActiveSheet.PivotTables("PivotTable1").DataPivotField.PivotItems("Sum of PM"). _
        Caption = "PM%"
    Range("A10").Select
    ActiveSheet.PivotTables("PivotTable1").DataPivotField.PivotItems("Sum of GM"). _
        Caption = "GM%"
    Range("A11").Select
    ActiveSheet.PivotTables("PivotTable1").DataPivotField.PivotItems("Sum of PBT"). _
        Caption = "PBT%"
    

   


    With ActiveSheet.PivotTables("PivotTable1").PivotFields( _
        "GroupMasterProjectCode")
        .Orientation = xlPageField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("MasterProject")
        .Orientation = xlPageField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("ProjectCode")
        .Orientation = xlPageField
        .Position = 1
    End With
    

    With ActiveSheet.PivotTables("PivotTable1").PivotFields("MasterCustomerCode")
        .Orientation = xlPageField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("CustomerCode")
        .Orientation = xlPageField
        .Position = 1
    End With
    
    Range("A1").EntireRow.Insert
    Range("A2").EntireRow.Insert
    
     Dim year As String
    
    year = YR

    Range("A1").Select
    ActiveCell.FormulaR1C1 = "Total Revenue 31 Mar Rates are converted to KUSD using 31-Mar-" & year & " Exchange Rate"
    Range("A1").Select
     With Selection.Font
        .Color = -16776961
        .TintAndShade = 0
    End With

    Range("A1").Select
    Selection.Font.Bold = True
    
    Range("G21").Select
    ActiveWindow.DisplayGridlines = False
    Cells.Select
    With Selection.Font
        .Name = "Calibri"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
    End With
    Range("B11:M13").Select
    Selection.NumberFormat = "0.000"
    Selection.NumberFormat = "0.00"
    Selection.NumberFormat = "0.0"
    ActiveSheet.PivotTables("PivotTable1").PivotSelect "Values[All]", xlLabelOnly _
        + xlFirstRow, True
    Range("A9:H16").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
    

    Range("B12:I12").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlBottom
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    Range("B12:H15").Select
    With Selection
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    
     
 

    Range("B14:M16").Select
    Selection.NumberFormat = "0.00%"
    
    Range("B15:Z15").Select
    Selection.Copy
    Range("B16").Select
    Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
    Application.CutCopyMode = False

    Range("B12:Z12").Select
    Selection.Copy
    Range("B11").Select
    Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
    Application.CutCopyMode = False
  
   Range("A1:D1").Select
    With Selection.Font
        .Color = -16776961
        .TintAndShade = 0
    End With


     Range("B10:H10").Select
    
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With

 
    Range("A18").Select